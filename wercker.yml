build:
  services:
    - id: mysql
      env:
        MYSQL_ROOT_PASSWORD: password
  box:
    id: node:8.4.0
  steps:
    - script:
      name: echo nodejs information
      code: |
        echo "node version $(node -v) running"
        echo "npm version $(npm -v) running"
    - npm-install
    - script:
        name: install local packages
        code: sudo npm install dotenv
    - script:
        name: install global packages
        code: sudo npm install -g jasmine istanbul
    - script:
        name: write coveralls token file
        code: |
          echo "repo_token: $COVERALLS" > .coveralls.yml
    - script:
        name: write env file
        code: |
          echo "CI_BUILD=true" > .env
          echo "DB_HOST=$MYSQL_PORT_3306_TCP_ADDR" >> .env
          echo "DB_SCHEMA=$MYSQL_DATABASE" >> .env
    - script:
        name: show env
        code: |
          cat .env
    - script:
        name: run coverage tests
        code: npm run coverage
